%% Artificial Fish behavior 1
close all;
clear all;
clc;
%% Initializaion 
format long
Sensor_distance = 2.5;   %????????
Step_max = 0.3;     %??????????
N = 10;         %??????
iterration = 50;%???????
delta=0.618;     %?????
a1 = -10; b1 = 10; a2 = -10; b2 = 10; 
d = [];%??50??????????;
k = 0; 
m = 10;%????
X1 = rand(N,1)*(b1-a1)+a1;  %?-10~10???????50???
X2 = rand(N,1)*(b2-a2)+a2;
X = [X1 X2]; 
%% Testing
x = 3;
y = 6;
A = [x y];
d = Decision(A);
%% Fish position initailizaiton
for i = 1:N
    www = [X(i,1),X(i,2)];
    d(i) = Decision(www);   
end

%???????????????????
[w,i] = max(d);         % ???????????w???????i?
maxX = [X(i,1),X(i,2)]; % ??????????????
maxY = w;               % ?????????????

figurex = []; figurey = []; figurez = [];

figurex(numel(figurex)+1) = maxX(1);    % ?maxX?1???figurex??
figurey(numel(figurey)+1) = maxX(2);    % numel?????????????????matlab????????1???
figurez(numel(figurez)+1) = maxY;
Matrix_XXR1 =[];
XXR1 =[];
while (k<m)
for i = 1:N
        XX = [X(i,1),X(i,2)];   %?????????????????
        
%%%%%%????????????????????????????
%???????????????????????????
%????????maxf?Xc????????????
        nf1=0;
        Xc=0;
        label_swarm =0;  %????????
        for j = 1:N 
            XX_1 = [X(j,1), X(j,2)];        
            if (norm(XX_1-XX)<Sensor_distance)  % norm?????XXX-XX???????????2???????        
                nf1 = nf1+1;     
                Xc = Xc+XX_1;      
            end    
        end
        Xc=Xc-XX;   %????XX???       
        nf1=nf1-1;
        Xc = Xc/nf1; %??Xc??XX?????????????? 
        if((Decision(Xc)/nf1 > delta*Decision(XX)) && (norm(Xc-XX)~=0))  
            XXR1=rand*Step_max*(Xc-XX)/norm(Xc-XX);
            XXnext1=XX+XXR1;
            
            if(XXnext1(1) > b1)          
                XXnext1(1) = b1;      
            end
            if(XXnext1(1) < a1)    
                XXnext1(1) = a1;   
            end
            if(XXnext1(2) > b2)       
                XXnext1(2) = b2;      
            end
            if(XXnext1(2) < a2)     
                XXnext1(2) = a2;  
            end
            label_swarm =1;
            temp_y_XXnext1=Decision(XXnext1);  
        else 
            label_swarm =0;
            temp_y_XXnext1=-inf;
        end
% plot

if (length(XXR1) ~= 0)
    Matrix_XXR1 = [Matrix_XXR1; XXR1,i];

end 
end

%% ????
%         if((label_swarm==0) && (label_follow==0) && (label_prey ==0))
          if((label_swarm==0))
            %?????????????????????????????????????
            %????????????????????????
            R2S=Step_max*(-1+2*rand(2,1)');
            R2S =[;R2S] ;
            temp_XX = XX+R2S;
            if(XX(1) > b1) % ??????????????????????????                              
                XX(1) = b1;               
            end
            if(XX(1) < a1)   
                XX(1) = a1;             
            end
            if(XX(2) > b2)     
                XX(2) = b2;             
            end
            if(XX(2) < a2)  
                XX(2) = a2;       
            end
            
          else

        XX=temp_XX;
        X(i,1) = XX(1);
        X(i,2) = XX(2); 
        
%??????????
  for i = 1:N
        XXX = [X(i,1),X(i,2)];
        if (maxf(XXX)>maxY)
            maxY = maxf(XXX);
            maxX = XXX;
            figurex(numel(figurex)+1) = maxX(1);
            figurey(numel(figurey)+1) = maxX(2);
            figurez(numel(figurez)+1) = maxY;
        end
  end
end
%plot results  
        x=X(i,1);
        y=X(i,2);
        figure;
        axis([-10 10 -10 10]);
    plot(x,y,'*r');
    hold on
  iter_end = length(Matrix_XXR1)
  i =0;
 for i = Matrix_XXR1(1,3):Matrix_XXR1(iter_end,3)
     x=X(i,1);
     y=X(i,2);
     plot(x,y,'*r');
     hold on
     j =find(Matrix_XXR1(:,3)==i);
        x1= Matrix_XXR1(j,1);
        y1= Matrix_XXR1(j,2);
        u = sqrt(x1.^2+y1.^2);
        v = atan(y1/x1);
     quiver(x,y,u,v)
 end
    k = k+1
%%
end
